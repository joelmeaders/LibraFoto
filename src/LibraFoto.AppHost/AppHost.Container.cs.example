// Alternative AppHost configuration for testing containerized builds
// To use this: Copy this content to AppHost.cs when you want to test containers during development

using System.Diagnostics;

var builder = DistributedApplication.CreateBuilder(args);

var db = builder.AddSqlite("LibraFotoDb");

// Run API as a container (tests your Dockerfile)
var api = builder.AddDockerfile("api", "../docker/Dockerfile.api")
    .WithReference(db)
    .WithHttpEndpoint(port: 5179, targetPort: 8080, name: "http")
    .WithEnvironment("ASPNETCORE_ENVIRONMENT", "Development")
    .WithEnvironment("ASPNETCORE_URLS", "http://+:8080");

// Frontends still run as npm processes for faster iteration
var displayFrontend = builder.AddNpmApp("display", "../../apps/display", "dev")
    .WithHttpEndpoint(port: 3000, targetPort: 3000, isProxied: false)
    .WithExternalHttpEndpoints();

var adminFrontend = builder.AddNpmApp("admin", "../../apps/admin", "start")
    .WithHttpEndpoint(port: 4200, targetPort: 4200, isProxied: false)
    .WithExternalHttpEndpoints();

builder.Build().Run();
